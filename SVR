set.seed(13343)
train_ind <- createDataPartition(y = LA_sample$Review_Scores_Rating,p=.8,list = FALSE)
training <- LA_sample[train_ind,]
test <- LA_sample[-train_ind,]


#see correlation and check collinearity
colnames(training)
summary(training)
training_t<-training
training_t[] <- lapply(training_t, as.numeric)
correlation<-data.frame(cor(training_t))


#delete review "Review_Scores_Value","Review_Scores_Accuracy","Review_Scores_Cleanliness","Review_Scores_Checkin","Review_Scores_Communication","Review_Scores_Location" and entire_house
training<- training[,-which(names(training) %in% c("Review_Scores_Value","Review_Scores_Accuracy","Review_Scores_Cleanliness","Review_Scores_Checkin","Review_Scores_Communication","Review_Scores_Location","entirehouse","Reviews_per_month","Number_of_reviews","reviews_per_month","recent_review"))]
test<-test[,-which(names(test) %in% c("Review_Scores_Value","Review_Scores_Accuracy","Review_Scores_Cleanliness","Review_Scores_Checkin","Review_Scores_Communication","Review_Scores_Location","entirehouse","Reviews_per_month", "Number_of_reviews","recent_review","reviews_per_month"))]
training<-training %>% clean_names()
test<-test %>% clean_names()
colnames(training)

training<- training[,-which(names(training) %in% c("Review_Scores_Value","Review_Scores_Accuracy","Review_Scores_Cleanliness","Review_Scores_Checkin","Review_Scores_Communication","Review_Scores_Location","entirehouse","Reviews_per_month","Number_of_reviews","reviews_per_month","recent_review"))]
test<-test[,-which(names(test) %in% c("Review_Scores_Value","Review_Scores_Accuracy","Review_Scores_Cleanliness","Review_Scores_Checkin","Review_Scores_Communication","Review_Scores_Location","entirehouse","Reviews_per_month", "Number_of_reviews","recent_review","reviews_per_month"))]
training<-training %>% clean_names()
test<-test %>% clean_names()
colnames(training)


#variable selection using Forward-stepwise regression
library(lars)
y = training$review_scores_rating
x = training[,-which(names(training)%in%"review_scores_rating")]
x_t<-as.matrix(x)
res = lars(x_t, y, type="stepwise")
print(summary(res))
res


training<-training[,c("x24_hour_check_in","host_is_superhost", "is_apartment", "is_house", "accommodates","host_response_rate","lock_on_bedroom_door", "condo", "minimum_nights", "availability_365", "townhouse", "loft", "guesthouse", "indoor_fireplace",
                                           "price", "venice_neighbourhood", "elevator_in_building", "host_total_listings_count", "bedrooms","santa_monica_neighbourhood", "pool", "maximum_nights", "privateroom", "long_beach_neighbourhood","hollywood_neighbourhood","review_scores_rating")]

test <- test[,c("x24_hour_check_in","host_is_superhost", "is_apartment", "is_house", "accommodates","host_response_rate","lock_on_bedroom_door", "condo", "minimum_nights", "availability_365", "townhouse", "loft", "guesthouse", "indoor_fireplace",
                "price", "venice_neighbourhood", "elevator_in_building", "host_total_listings_count", "bedrooms","santa_monica_neighbourhood", "pool", "maximum_nights", "privateroom", "long_beach_neighbourhood","hollywood_neighbourhood","review_scores_rating")]



#SVM
library(e1071)
model_svm = svm(review_scores_rating ~review_scores_accuracy+review_scores_communication+ host_is_superhost+ review_scores_location+
                host_total_listings_count+ number_of_reviews+is_apartment+ price+ accommodates+pool+ privateroom+
                availability_365+ review_scores_checkin+ hollywood_neighbourhood+ minimum_nights+ host_response_rate+ lock_on_bedroom_door+
                loft+ x24_hour_check_in+ indoor_fireplace+ guesthouse+ sharedroom+ santa_monica_neighbourhood, data = training)
print(model)


#model_1_training
pred_m1= predict(model_svm, training)


#check performance
R2(pred_m1,training$review_scores_rating,form="traditional")
MAE(pred_m1,training$review_scores_rating)
mltools::mse(pred_m1,training$review_scores_rating)
RMSE(pred_m1,training$review_scores_rating)

#model_test
pred_m1_t= predict(model_svm, test)

#check performance
R2(pred_m1_t,test$review_scores_rating,form="traditional")
MAE(pred_m1_t,test$review_scores_rating)
mltools::mse(pred_m1_t,test$review_scores_rating)
RMSE(pred_m1_t,test$review_scores_rating)


